$OpenBSD: patch-base_rand_util_posix_cc,v 1.3 2020/10/22 13:52:53 robert Exp $

Index: base/rand_util_posix.cc
--- base/rand_util_posix.cc.orig
+++ base/rand_util_posix.cc
@@ -25,6 +25,7 @@
 
 namespace {
 
+#if !defined(OS_OPENBSD)
 // We keep the file descriptor for /dev/urandom around so we don't need to
 // reopen it (which is expensive), and since we may not even be able to reopen
 // it if we are later put in a sandbox. This class wraps the file descriptor so
@@ -50,12 +51,14 @@ class URandomFd {
  private:
   const int fd_;
 };
+#endif
 
 }  // namespace
 
 namespace base {
 
 void RandBytes(void* output, size_t output_length) {
+#if !defined(OS_OPENBSD)
 #if defined(OS_MAC)
   // TODO(crbug.com/995996): Enable this on iOS too, when sys/random.h arrives
   // in its SDK.
@@ -71,11 +74,16 @@ void RandBytes(void* output, size_t output_length) {
   const bool success =
       ReadFromFD(urandom_fd, static_cast<char*>(output), output_length);
   CHECK(success);
+#else
+  arc4random_buf(static_cast<char*>(output), output_length);
+#endif
 }
 
+#if !defined(OS_OPENBSD)
 int GetUrandomFD() {
   static NoDestructor<URandomFd> urandom_fd;
   return urandom_fd->fd();
 }
+#endif
 
 }  // namespace base
