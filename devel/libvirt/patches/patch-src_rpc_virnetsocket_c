$OpenBSD$
--- src/rpc/virnetsocket.c.orig	Wed Aug 22 12:00:59 2012
+++ src/rpc/virnetsocket.c	Mon Sep  3 18:09:56 2012
@@ -31,6 +31,10 @@
 #include <fcntl.h>
 #include <netdb.h>
 
+#ifdef HAVE_SYS_UCRED_H
+# include <sys/ucred.h>
+#endif
+
 #ifdef HAVE_NETINET_TCP_H
 # include <netinet/tcp.h>
 #endif
@@ -999,9 +1003,9 @@ int virNetSocketGetUNIXIdentity(virNetSocketPtr sock,
         return -1;
     }
 
-    *pid = cr.pid;
-    *uid = cr.uid;
-    *gid = cr.gid;
+    *pid = getpid();
+    *uid = cr.cr_uid;
+    *gid = cr.cr_gid;
 
     virMutexUnlock(&sock->lock);
     return 0;
