--- lib/mount_bsd.c.orig	Tue Sep  4 12:17:46 2012
+++ lib/mount_bsd.c	Tue Nov 13 11:39:46 2012
@@ -6,6 +6,8 @@
   See the file COPYING.LIB.
 */
 
+#include <machine/cpu.h>
+#include <sys/param.h>
 #include "fuse_i.h"
 #include "fuse_misc.h"
 #include "fuse_opt.h"
@@ -26,6 +28,7 @@
 
 #define FUSERMOUNT_PROG		"mount_fusefs"
 #define FUSE_DEV_TRUNK		"/dev/fuse"
+#define SPECNAMELEN 15
 
 enum {
 	KEY_ALLOW_ROOT,
@@ -230,7 +233,7 @@ void fuse_kern_unmount(const char *mountpoint, int fd)
 	if (fstat(fd, &sbuf) == -1)
 		return;
 
-	devname_r(sbuf.st_rdev, S_IFCHR, dev, 128);
+	strncpy(dev,devname(sbuf.st_rdev, S_IFCHR), 128);
 
 	if (strncmp(dev, "fuse", 4))
 		return;
@@ -249,7 +252,7 @@ static int init_backgrounded(void)
 
 	len = sizeof(ibg);
 
-	if (sysctlbyname("vfs.fuse.init_backgrounded", &ibg, &len, NULL, 0))
+	if (sysctl("vfs.fuse.init_backgrounded", 26, &ibg, &len, NULL, 0))
 		return 0;
 
 	return ibg;
