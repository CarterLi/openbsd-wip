$OpenBSD$
--- test-random.sh.orig	Sun May  5 11:43:15 2013
+++ test-random.sh	Sun May  5 11:44:44 2013
@@ -1,22 +1,12 @@
-#!/bin/bash
+#!/bin/ksh
 
-check_tainted()
-{
-    if [ "$(cat /proc/sys/kernel/tainted)" != $TAINT ]; then
-      echo ERROR: Taint flag changed $(cat /proc/sys/kernel/tainted)
-      exit
-    fi
-}
-
 if [ ! -d tmp ]; then
   mkdir tmp
 fi
 chmod 755 tmp
 cd tmp
 
-TAINT=$(cat /proc/sys/kernel/tainted)
-
-NR_CPUS=`grep ^processor /proc/cpuinfo | /usr/bin/wc -l`
+NR_CPUS=`sysctl -n hw.ncpufound`
 NR_PROCESSES=$(($NR_CPUS * 2))
 
 while [ 1 ];
@@ -36,12 +26,10 @@ do
 
     popd
 
-    check_tainted
   done
 
   wait
   sleep 1
-  check_tainted
 
   chmod 755 ../tmp
 
