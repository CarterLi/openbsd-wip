$OpenBSD$

Index: src/ints/bios.cpp
--- src/ints/bios.cpp.orig
+++ src/ints/bios.cpp
@@ -39,7 +39,6 @@
 extern bool PS1AudioCard;
 #include "parport.h"
 #include <time.h>
-#include <sys/timeb.h>
 /* mouse.cpp */
 extern bool en_bios_ps2mouse;
 extern bool mainline_compatible_bios_mapping;
@@ -2244,11 +2243,11 @@ static Bitu INT11_Handler(void) {
 
 static void BIOS_HostTimeSync() {
 	/* Setup time and date */
-	struct timeb timebuffer;
-	ftime(&timebuffer);
+	struct timeval timebuffer;
+	gettimeofday(&timebuffer,NULL);
 	
 	struct tm *loctime;
-	loctime = localtime (&timebuffer.time);
+	loctime = localtime (&timebuffer.tv_sec);
 
 	/*
 	loctime->tm_hour = 23;
@@ -2267,7 +2266,7 @@ static void BIOS_HostTimeSync() {
 		loctime->tm_hour*3600*1000+
 		loctime->tm_min*60*1000+
 		loctime->tm_sec*1000+
-		timebuffer.millitm))*(((double)PIT_TICK_RATE/65536.0)/1000.0));
+		timebuffer.tv_usec))*(((double)PIT_TICK_RATE/65536.0)/1000.0));
 	mem_writed(BIOS_TIMER,ticks);
 }
 
