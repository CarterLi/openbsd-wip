$OpenBSD$
--- CMakeLists.txt.orig	Sun Jan  5 09:45:24 2014
+++ CMakeLists.txt	Thu Feb 13 21:29:05 2014
@@ -59,6 +59,8 @@ if (ENABLE_TAGLIB)
 endif (ENABLE_TAGLIB)
 
 if (TAGLIB_FOUND)
+    set(TAGLIB_MIN_VERSION "1.6")
+    find_package(Taglib)
     if (ENABLE_CDPARANOIA)
         find_package(Cdparanoia)
         if (CDPARANOIA_FOUND)
@@ -166,12 +168,6 @@ if (ENABLE_HTTP_STREAM_PLAYBACK)
     endif (ENABLE_QT5)
 endif (ENABLE_HTTP_STREAM_PLAYBACK)
 
-if (ENABLE_KDE)
-    find_package(KDE4 REQUIRED)
-    add_definitions(-DENABLE_KDE_SUPPORT)
-    set(ENABLE_KDE_SUPPORT TRUE)
-endif (ENABLE_KDE)
-
 if (NOT ENABLE_QT5 AND NOT WIN32 AND NOT APPLE)
     find_package(QJSON)
 endif (NOT ENABLE_QT5 AND NOT WIN32 AND NOT APPLE)
@@ -416,14 +412,17 @@ add_subdirectory(streams/providers)
 add_subdirectory(online/icons)
 
 if (ENABLE_KDE)
+    find_package(KDE4 REQUIRED)
+    add_definitions(-DENABLE_KDE_SUPPORT)
+    set(ENABLE_KDE_SUPPORT TRUE)
     include_directories(${KDE4_INCLUDES})
     add_definitions(${KDE4_DEFINITIONS})
     qt4_add_resources(CANTATA_RC_SRCS ${CANTATA_RCS})
     kde4_add_ui_files(CANTATA_UI_HDRS ${CANTATA_UIS})
     kde4_add_executable(cantata ${CANTATA_SRCS} ${CANTATA_MOC_SRCS} ${CANTATA_RC_SRCS} ${CANTATA_UI_HDRS})
-    target_link_libraries(cantata ${KDE4_KDECORE_LIBS} ${KDE4_KDEUI_LIBS} ${KDE4_SOLID_LIBS} ${KDE4_KIO_LIBRARY} X11)
+    target_link_libraries(cantata ${KDE4_KDECORE_LIBS} ${KDE4_KDEUI_LIBS} ${KDE4_SOLID_LIBS} ${KDE4_KIO_LIBRARY})
     if (NOT WIN32 AND NOT APPLE AND TAGLIB_FOUND AND ENABLE_REMOTE_DEVICES)
-        target_link_libraries(cantata ${KDE4_KFILE_LIBS})
+        target_link_libraries(cantata ${KDE4_KFILE_LIBS} ${KDE4_KDECORE_LIBS} ${KDE4_KDEUI_LIBS} ${KDE4_SOLID_LIBS} ${KDE4_KIO_LIBRARY})
     endif (NOT WIN32 AND NOT APPLE AND TAGLIB_FOUND AND ENABLE_REMOTE_DEVICES)
     install(TARGETS cantata ${INSTALL_TARGETS_DEFAULT_ARGS})
 else (ENABLE_KDE)
@@ -498,7 +497,7 @@ else (ENABLE_KDE)
         target_link_libraries(cantata qxt)
     endif (WIN32 OR APPLE OR NOT ENABLE_QT5)
     if (NOT ENABLE_QT5 AND NOT APPLE AND NOT WIN32)
-        target_link_libraries(cantata X11)
+        target_link_libraries(cantata)
     endif (NOT ENABLE_QT5 AND NOT APPLE AND NOT WIN32)
 endif (ENABLE_KDE)
 
@@ -545,6 +544,7 @@ endif (QJSON_FOUND)
 
 add_subdirectory(3rdparty/qtiocompressor)
 add_subdirectory(icons)
+add_subdirectory(support)
 
 target_link_libraries(cantata support qtiocompressor ${QTLIBS} ${ZLIB_LIBRARIES})
 include_directories(${QTINCLUDES} ${ZLIB_INCLUDE_DIRS})
